<button
  id="darkModeToggle"
  aria-label="切换深色模式"
  class="p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-gray-500 transition-colors duration-300 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"
>
  <span id="themeText">浅</span>
</button>

<script is:inline>
  // 在 DOM 加载前尽可能早地设置主题，避免 FOUC
  (function () {
    const storedTheme = localStorage.getItem("theme");
    const prefersDark = window.matchMedia(
      "(prefers-color-scheme: dark)"
    ).matches;
    const isDark = storedTheme === "dark" || (!storedTheme && prefersDark);

    if (isDark) {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }

    // 设置初始文字
    const themeText = document.getElementById("themeText");
    themeText.textContent = isDark ? "深" : "浅";
  })();

  // 点击切换逻辑
  const darkModeToggle = document.getElementById("darkModeToggle");
  const themeText = document.getElementById("themeText");

  function toggleDarkMode() {
    const isDark = document.documentElement.classList.contains("dark");
    if (isDark) {
      document.documentElement.classList.remove("dark");
      themeText.textContent = "浅";
      localStorage.setItem("theme", "light");
    } else {
      document.documentElement.classList.add("dark");
      themeText.textContent = "深";
      localStorage.setItem("theme", "dark");
    }
  }

  darkModeToggle.addEventListener("click", toggleDarkMode);
</script>

<style>
  /* 确保按钮和文字样式一致 */
  #darkModeToggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    font-size: 16px;
    font-weight: bold;
    color: #333;
  }
  .dark #darkModeToggle {
    color: #fff;
  }
</style>
